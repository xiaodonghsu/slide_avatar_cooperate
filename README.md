# 应用开发的场景和解决方案
在某些展示场景中，人们希望ppt的播放与提前录制好的数字人讲解协同完成。
前置条件：
ppt已驻准备好;
为每一页录制的数字人录像视频；

操作场景：
1、自动讲解模式：由程序完成，程序自动化的播放完ppt，并协同数字人播放每一页的胶片；
2、协同讲解模式：每一页的播放由人控制；
3、讲解员模式：不出现数字人，由讲解员自主完成讲解

对数字人视频的要求：
透明模式，数字人形象悬浮在ppt播放页面的上方；

暂停功能：
能打断和暂停，数字人的演讲

# 应用架构
## 控制模块(controller)
功能涉及与 Powerpoint应用，有些场景是 wps 应用的交互, 其支持 COM 接口.
由于 js 的 winax 组件使用非常麻烦，先采用 Python 方式开发；
工作原理：
### websocket 服务功能
开启 5678 websocket 端口，接收消息，控制消息

### ppt监测功能
每秒监测当前的播放页面的编号;根据工作模式，决定数字人播放的内容。

### 消息处理功能

## 数字人播放模块(avatar)
实际是一个网页播放器, 可以播放透明的数字人录制视频的程序, JS的。
该模块启动后，主动连接127.0.0.1:5678的端口，无法连接时，反复重试；
接收来自controller的消息，根据播放列表播放内容，并相应来自控制器的 pause， stop 功能。

# 应用功能
controller 向数字人接口websocket的消息包括：
## 1. 播放列表
新的播放列表下发后;冲掉之前的播放列表,并立即以新的播放列表播放;下发的playlist列表为空时,清除播放列表(起到停止的作用);
逻辑：用新的播放列表替换以前的列表。
```JSON
{"tasks": "playlist",
  "playlist": [
      {"video": "../assets/videos/video1.webm", "loop": 1, "left": 1200, "top": 700, "width": 100, "height": 300}, //播放1次
       {"image": "../assets/videos/video2.jpeg", "loop": 3}, //持续3秒
       {"video": "../assets/videos/video1.webm", "loop": -1}  //无限循环
        ...
        ]
}
```
## 2. 暂停
保持播放列表，当前播放内容暂停
```JSON
{"tasks": "pause"}
```
## 3. 继续播放
在当前的播放列表, 继续当前播放内容
```JSON
{"tasks": "play"}
```
